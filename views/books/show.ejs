<%- include('../partials/header.ejs') %>
    <% if (!user) { %>
        <h2><%= book.name %></h2>
        <h2><%= user.name %></h2>
        <img src="<%= book.cover %>" alt="<%= book.name %>" width="300" />
        <p><%= book.author %></p>
        <p><%= book.description %></p>

        <% book.reviews.forEach(review => { %>
            <h4>Title: <%= review.title %></h4>
            <p>Reviewed By: <%= review.author %></p>
            <p>Description: <%= review.description %></p>
            <p>Rating: <%= review.rating %></p>
        <% }) %>

    <% } else { %> 
    <h2><%= book.name %></h2>
    <img src="<%= book.cover %>" alt="<%= book.name %>" width="300" />
    <p>Book Author: <%= book.author %></p>
    <p>Description: <%= book.description %></p>

    <% book.reviews.forEach(review => { %>
        <h4>Title: <%= review.title %></h4>
        <p>Reviewed By: <%= review.author %></p>
        <p>Description: <%= review.description %></p>
        <p>Rating: <%= review.rating %></p>

        <% if (user._id === review.author._id.toString()) { %>
            <button>Delete</button>
            <button onclick="window.location.href='/reviews/<%= review._id %>/edit'">Edit</button>
        
            </a>

        <% } %>
    <% }) %>

    <form action="/reviews" method="POST">
        <label for="title">Title</label>
        <input type="text" name="title" id="title" required />
        <label for="description">Description</label>
        <textarea name="description" id="description" required></textarea>
        <select name="rating" id="rating">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <input type="hidden" name="book" value="<%= book._id %>" >
        <input type="hidden" name="author" value="<%= user._id %>" >
        <button type="submit">Add Review</button>
    </form>

   <% } %>

<%- include('../partials/footer.ejs') %>